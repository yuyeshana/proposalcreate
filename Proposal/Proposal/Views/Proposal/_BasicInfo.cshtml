@model Proposal.Models.ProposalModel
@using Microsoft.AspNetCore.Mvc.Rendering

                    <div id="baseDiv" class="form-content active">
                        <!-- 基本情報セクション -->
                        <div class="form-card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle me-2"></i>基本情報</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">提案年度</label>
                                        @Html.TextBoxFor(m => m.TeianYear, new { @class = "form-control-modern ", @readonly = "readonly", id = "teianYear" })
                                    </div>
                                </div>
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">提案題名 <span class="required-badge">必須</span></label>
                                        @Html.TextBoxFor(m => m.TeianDaimei, new { @class = "form-control-modern", placeholder = "提案題名を入力してください" })
                                        @Html.ValidationMessageFor(m => m.TeianDaimei, "", new { @class = "validation-message" })
                                    </div>
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">提案の種類 <span class="required-badge">必須</span></label>
                                        @Html.DropDownListFor(m => m.ProposalTypeId, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).ProposalTypes, new { @class = "form-control-modern" })
                                        @Html.ValidationMessageFor(m => m.ProposalTypeId, "", new { @class = "validation-message" })
                                    </div>
                                </div>
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">提案の区分 <span class="required-badge">必須</span></label>
                                        @Html.DropDownListFor(m => m.ProposalKbnId, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).ProposalKbn, new { @class = "form-control-modern", id = "teianKbn" })
                                        @Html.ValidationMessageFor(m => m.ProposalKbnId, "", new { @class = "validation-message" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 提案者情報セクション -->
                        <div class="form-card">
                            <div class="card-header">
                                <h5><i class="fas fa-user me-2"></i>提案者情報</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">所属</label>
                                        @Html.TextBoxFor(m => m.AffiliationName, new { @class = "form-control-modern", @readonly = "readonly" })
                                        @Html.HiddenFor(m => m.AffiliationId)
                                    </div>
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">部・署</label>
                                        @Html.TextBoxFor(m => m.DepartmentName, new { @class = "form-control-modern", @readonly = "readonly" })
                                        @Html.HiddenFor(m => m.DepartmentId)
                                    </div>
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">課・部門</label>
                                        @Html.TextBoxFor(m => m.SectionName, new { @class = "form-control-modern", @readonly = "readonly" })
                                        @Html.HiddenFor(m => m.SectionId)
                                    </div>
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">係・担当</label>
                                        @Html.TextBoxFor(m => m.SubsectionName, new { @class = "form-control-modern", @readonly = "readonly" })
                                        @Html.HiddenFor(m => m.SubsectionId)
                                    </div>
                                </div>
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern" id="shimeiLabel">氏名又は代表名 <span class="required-badge">必須</span></label>
                                        @Html.TextBoxFor(m => m.ShimeiOrDaihyoumei, new { @class = "form-control-modern", placeholder = "氏名を入力してください" })
                                        @Html.ValidationMessageFor(m => m.ShimeiOrDaihyoumei, "", new { @class = "validation-message" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- グループ情報セクション -->
                        <div class="form-card" id="groupSection" style="display:none">
                            <div class="card-header">
                                <h5><i class="fas fa-users me-2"></i>グループの全員（代表者を除く）</h5>
                            </div>
                            <div class="form-row-modern single">
                                <div class="form-group-modern" style="max-width: 50%;">
                                    <label class="form-label-modern">グループ名</label>
                                    @Html.TextBoxFor(m => m.GroupMei, new { @class = "form-control-modern", placeholder = "グループ名を入力してください" })
                                    @Html.ValidationMessageFor(m => m.GroupMei, "", new { @class = "validation-message" })
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                    <div id="groupMembersContainer">
                                      @for (int i = 1; i <= 10; i++)
                                      {
                                          // StatusがNULLの場合（新規状態）：前3つのメンバーのみ表示
                                          // StatusがNULL以外の場合：AffiliationIdが存在するメンバーのみ表示
                                          bool shouldDisplay = false;
                                          if (Model.Status == null)
                                          {
                                              // 新規状態：前3つのメンバーのみ表示
                                              shouldDisplay = (i <= 3);
                                          }
                                          else
                                          {
                                              // 編集状態：AffiliationIdが存在するメンバーのみ表示
                                              shouldDisplay = !string.IsNullOrEmpty(Model.GroupMembers[i-1]?.AffiliationId?.ToString());
                                          }
                                          <div class="border rounded p-3 bg-light mb-3 member-item" data-member-index="@(i-1)" style="@(!shouldDisplay ? "display: none;" : "")">
                                             <div class="d-flex justify-content-between align-items-center mb-2">
                                                 <h6 class="mb-0"><i class="fas fa-user me-2" style="color: #136AA8;"></i>メンバー@(i)</h6>
                                                 <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeMember(this)">
                                                     <i class="fas fa-trash"></i>
                                                 </button>
                                             </div>
                                             <div class="form-row-modern">
                                                   <div class="form-group-modern">
                                                       <label class="form-label-modern">所属</label>
                                                       @Html.DropDownListFor(m => m.GroupMembers[i-1].AffiliationId, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Affiliations, 
                                                       new { @class = "form-control-modern", id = $"memberAffiliation_{i-1}" })
                                                   </div>
                                                   <div class="form-group-modern">
                                                       <label class="form-label-modern">部・署</label>
                                                       @Html.DropDownListFor(m => m.GroupMembers[i-1].DepartmentId, 
                                                       new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                                       new { 
                                                        @class = "form-control-modern", 
                                                        id = $"memberDepartment_{i-1}", 
                                                        data_current_dept = Model.GroupMembers[i-1].DepartmentId})
                                                   </div>
                                               </div>
                                               <div class="form-row-modern">
                                                   <div class="form-group-modern">
                                                       <label class="form-label-modern">課・部門</label>
                                                       @Html.DropDownListFor(m => m.GroupMembers[i-1].SectionId, 
                                                       new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                                       new { 
                                                        @class = "form-control-modern", 
                                                        id = $"memberSection_{i-1}", 
                                                        data_current_section = Model.GroupMembers[i-1].SectionId})
                                                   </div>
                                                   <div class="form-group-modern">
                                                       <label class="form-label-modern">係・担当</label>
                                                       @Html.DropDownListFor(m => m.GroupMembers[i-1].SubsectionId, 
                                                       new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                                       new { 
                                                        @class = "form-control-modern", 
                                                        id = $"memberSubsection_{i-1}", 
                                                        data_current_subsection = Model.GroupMembers[i-1].SubsectionId})
                                                   </div>
                                               </div>
                                              <div class="form-row-modern">
                                                  <div class="form-group-modern">
                                                      <label class="form-label-modern">氏名</label>
                                                      @Html.TextBoxFor(m => m.GroupMembers[i-1].Name, new { @class = "form-control-modern", placeholder = "氏名を入力" })
                                                  </div>
                                              </div>
                                         </div>
                                     }
                                 </div>
                                <div class="d-flex justify-content-end mt-3">
                                    <button type="button" id="addMemberBtn" class="btn btn-add-member shadow-sm" onclick="addMember()">
                                        <i class="fas fa-plus me-2"></i>追加
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 第一次審査者情報セクション -->
                        <div class="form-card">
                            <div class="card-header">
                                <h5><i class="fas fa-user-check me-2"></i>第一次審査者情報</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-group-modern mt-2 mb-3">
                                    <label class="form-label-modern">
                                        @Html.CheckBoxFor(m => m.SkipFirstReviewer)
                                        <span class="ms-2">第一次審査者を経ずに提出する</span>
                                    </label>
                                </div>
                                <div id="daiichishinsashaInputs" class="border rounded p-3 bg-light">
                                    <div class="form-row-modern">
                                        <div class="form-group-modern">
                                            <label class="form-label-modern">所属</label>
                                            @Html.DropDownListFor(m => m.FirstReviewerAffiliationId, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Affiliations, 
                                            new { @class = "form-control-modern", id = "firstReviewerAffiliation" })
                                        </div>
                                        <div class="form-group-modern">
                                            <label class="form-label-modern">部・署</label>
                                            @Html.DropDownListFor(m => m.FirstReviewerDepartmentId, 
                                            new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                            new { @class = "form-control-modern", id = "firstReviewerDepartment", data_current_dept = Model.FirstReviewerDepartmentId })
                                        </div>
                                    </div>
                                    <div class="form-row-modern">
                                        <div class="form-group-modern">
                                            <label class="form-label-modern">課・部門</label>
                                            @Html.DropDownListFor(m => m.FirstReviewerSectionId, 
                                            new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                            new { @class = "form-control-modern", id = "firstReviewerSection", data_current_section = Model.FirstReviewerSectionId })
                                        </div>
                                        <div class="form-group-modern">
                                            <label class="form-label-modern">係・担当</label>
                                            @Html.DropDownListFor(m => m.FirstReviewerSubsectionId, 
                                            new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "選択してください", 
                                            new { @class = "form-control-modern", id = "firstReviewerSubsection", data_current_subsection = Model.FirstReviewerSubsectionId })
                                        </div>
                                    </div>
                                    <div class="form-row-modern">
                                        <div class="form-group-modern">
                                            <label class="form-label-modern">氏名</label>
                                            @Html.TextBoxFor(m => m.FirstReviewerName, new { @class = "form-control-modern", placeholder = "氏名を入力" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 審査項目情報セクション -->
                        <div class="form-card">
                            <div class="card-header">
                                <h5><i class="fas fa-clipboard-check me-2"></i>審査項目情報</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">主務課 <span class="required-badge">必須</span></label>
                                        @* @Html.DropDownListFor(m => m.EvaluationSectionId, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Shumukas, new { @class = "form-control-modern" })
                                        @Html.ValidationMessageFor(m => m.EvaluationSectionId, "", new { @class = "validation-message" }) *@
                                    </div>              
                                </div>
                                <div class="form-row-modern">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">関係課 <span class="required-badge">必須</span></label>
                                        @Html.ValidationMessageFor(m => m.ResponsibleSectionId1, "", new { @class = "validation-message" })
                                        <div class="d-flex flex-column gap-2">
                                            <div>
                                                @* @Html.DropDownListFor(m => m.ResponsibleSectionId1, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Kankeikas, new { @class = "form-control-modern" }) *@
                                            </div>
                                            @* <div>@Html.DropDownListFor(m => m.ResponsibleSectionId2, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Kankeikas, new { @class = "form-control-modern" })</div> *@
                                            @* <div>@Html.DropDownListFor(m => m.ResponsibleSectionId3, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Kankeikas, new { @class = "form-control-modern" })</div> *@
                                            @* <div>@Html.DropDownListFor(m => m.ResponsibleSectionId4, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Kankeikas, new { @class = "form-control-modern" })</div> *@
                                            @* <div>@Html.DropDownListFor(m => m.ResponsibleSectionId5, ((Proposal.BL.ProposalBL.DropdownsViewModel)ViewBag.Dropdowns).Kankeikas, new { @class = "form-control-modern" })</div> *@
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 